<!DOCTYPE html>

<link rel=stylesheet href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
<link rel=stylesheet href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
	body, html {margin: 0; height: 100%}

	body {
		display: flex;
		flex-direction: column;
	}

	#header-bar {
		width: 100%;
		height: 64px;
		background: #75BEB3;
		flex-grow: 0;
		flex-shrink: 0;
	}
	
	#footer {
		width: 100%;
		height: 64px;
		background: #75BEB3;
		flex-grow: 0;
		flex-shrink: 0;
		font-size: 70%;
		text-align: center;
		padding: 8px;
		box-sizing: border-box;
	}

	#logo {
		display: block;
		margin: auto;
	}

	#container {
		display: block;
		flex-grow: 1;
		margin: 32px;
	}

	#overlay {
		position: fixed;
		z-index: 1;
		top: 0; left: 0; width: 100%; height: 100%;

		display: flex;
		justify-content: center;
		align-items: center;
		
	}

	.popup {
		display: inline;
		width: 50%;
		flex: 0 0 auto;
	}

	.close-button {
		position: absolute;
		top: 10px;
		right: 10px;
		font-size: 200%;
		color: white;
		cursor: pointer;
	}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="datamaps.world.min.js"></script>
<script src="constants.js"></script>

<div id="header-bar">
	<img id=logo src="http://www.equalmeasures2030.org/wp-content/uploads/2017/10/em2030.jpg" height=100%>
</div>

<div id="container"></div>

<div id=overlay style="display: none">
<div class="card popup">
	<img src="http://www.equalmeasures2030.org/wp-content/uploads/2017/03/Empowerment_Senegal_4-Home.jpg" class="card-img-top" style="width: 100%; height: 200px; object-fit: cover">
	<div class="card-body">
		<h2 class="card-title"><b>Indicators</b> for <b id="country-name"></b></h2>
	</div>
	<div class="close-button fa fa-times" onclick="document.getElementById('overlay').style.display='none'"></div>
	<div id="graph"></div>
</div>
</div>

<footer id="footer">
	Select an indicator for comparison: 
	<input type="radio" name="indicators" value="MAC" checked id="mac"><label for="mac">Married using any contraception</label>
	<input type="radio" name="indicators" value="MMC" id="mmc"><label for="mmc">Married using modern contraception</label>
	<input type="radio" name="indicators" value="UNFP" id="unfp"><label for="unfp">Unmet need for family planning</label>
	<input type="radio" name="indicators" value="DFP" id="dfp"><label for="dfp">Demand for family planning by modern methods</label>
	<input type="radio" name="indicators" value="NAC" id="nac"><label for="nac">No antenatal care</label>
	<input type="radio" name="indicators" value="WSHE" id="wshe"><label for="wshe">With secondary/higher education</label>
	<p>For more information visit our <a href="http://www.equalmeasures2030.org/">website</a>.</p>
</footer>

<script>
	var dataOut = {};
	$.getJSON("http://127.0.0.1:5000/data?years=1995..2000", function(data) {
		data.forEach(function(row) {
			var fillKey;
			if(row[2] > 70) fillKey = "HIGH";
			else if(row[2] > 50) fillKey = "MEDIUM";
			else fillKey = "LOW";

			dataOut[countries[row[0]]] = {
				numberOfThings: row[2],
				fillKey: fillKey
			};
		});

		var map = new Datamap({
			element: document.getElementById('container'),
			fills: {
				HIGH: "red",
				LOW: "blue",
				MEDIUM: "purple",
				defaultFill: "gray"
			},
			data: dataOut
		});

		document.getElementsByClassName("IND").onclick = function() {
			document.getElementById("overlay").style.display = "flex";
		}
	});

	Plotly.newPlot("graph", [{
		x: ["Marriage w/ Contraception", "Marriage M. Contraception", "Married by 15", "Married by 18"],
		y: [80, 63, 47, 59],
		type: "bar",
		hoverinfo: "none"
	}]);
</script>
